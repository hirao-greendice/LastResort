<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>博士映像画面</title>
    <link rel="stylesheet" href="doctor.css">
</head>
<body>
    <div class="doctor-container">
        <div class="doctor-frame">
            <div class="doctor-content" id="doctorContent">
                <!-- 博士映像がここに表示される -->
                <div class="doctor-video-container" id="doctorVideoContainer">
                    <video id="doctorVideo" class="doctor-video" playsinline preload="metadata" style="display: none;">
                        <source src="doctor.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="doctor-message" id="doctorMessage" style="display: none;">
                    </div>
                    <div class="fade-overlay" id="fadeOverlay" style="display: none;"></div>
                    <!-- 待機インジケーター（左下の小さな赤丸） -->
                    <div class="waiting-indicator" id="waitingIndicator" style="display: none;"></div>
                </div>
            </div>
        </div>
        
        <!-- 隠しボタン -->
        <button class="hidden-button hidden-button-left" id="homeButton"></button>
        <button class="hidden-button hidden-button-right" id="settingsButton"></button>
        <button class="hidden-button fullscreen-button" id="doctorFullscreenButton"></button>
        
        <!-- コントロールパネル -->
        <div class="control-panel" id="controlPanel">
            <h3>博士映像設定</h3>
            
            <!-- 映像設定 -->
            <div class="control-group">
                <label for="videoOpacity">映像透明度 (%)</label>
                <div class="input-group">
                    <input type="range" id="videoOpacity" min="0" max="100" step="5" value="100">
                    <input type="number" id="videoOpacityInput" min="0" max="100" step="5" value="100">
                    <span id="videoOpacityValue">100%</span>
                </div>
            </div>
            
            <div class="control-group">
                <label for="videoScale">映像サイズ (%)</label>
                <div class="input-group">
                    <input type="range" id="videoScale" min="50" max="200" step="5" value="100">
                    <input type="number" id="videoScaleInput" min="50" max="200" step="5" value="100">
                    <span id="videoScaleValue">100%</span>
                </div>
            </div>
            
            <!-- 表示制御 -->
            <div class="control-group">
                <label>表示状態</label>
                <div class="status-display">
                    <div class="status-item">
                        <span>接続状態:</span>
                        <span id="connectionStatusDisplay">接続中...</span>
                    </div>
                    <div class="status-item">
                        <span>映像状態:</span>
                        <span id="videoStatusDisplay">待機中</span>
                    </div>
                </div>
            </div>
            
            <div class="control-buttons">
                <button class="control-btn" id="resetButton">リセット</button>
                <button class="control-btn close" id="closeButton">閉じる</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, onSnapshot, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getDatabase, ref, onValue, set } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCMqH0u_bO2knTMMSDjzwKbQBECUdzlwnc",
            authDomain: "lastr-36807.firebaseapp.com",
            databaseURL: "https://lastr-36807-default-rtdb.firebaseio.com",
            projectId: "lastr-36807",
            storageBucket: "lastr-36807.firebasestorage.app",
            messagingSenderId: "1068261467238",
            appId: "1:1068261467238:web:22c701f8879d6bb61c79a7",
            measurementId: "G-1S8C9GC4GY"
        };

        try {
            const app = initializeApp(firebaseConfig);
            console.log('Firebase app initialized:', app);
            
            // Firestore を試行
            try {
                const firestore = getFirestore(app);
                console.log('Firestore initialized successfully');
                window.firestore = firestore;
                window.firestoreDoc = doc;
                window.firestoreOnSnapshot = onSnapshot;
                window.firestoreSetDoc = setDoc;
                window.useFirestore = true;
            } catch (firestoreError) {
                console.warn('Firestore initialization failed:', firestoreError);
                window.useFirestore = false;
            }
            
            // Database を試行
            try {
                const database = getDatabase(app);
                console.log('Database initialized successfully');
                            window.database = database;
            window.dbRef = ref;
            window.dbOnValue = onValue;
            window.dbSet = set;
                
                if (!window.useFirestore) {
                    console.log('Using Database as primary storage');
                }
            } catch (dbError) {
                console.warn('Database initialization failed:', dbError);
                
                if (!window.useFirestore) {
                    console.error('Both Firestore and Database failed to initialize');
                }
            }
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }
    </script>
    
    <script src="doctor.js"></script>
</body>
</html>