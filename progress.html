<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>進捗管理画面</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier Prime', monospace;
            background: linear-gradient(45deg, #0a0a0a, #1a1a1a);
            color: #00ff00;
            height: 100vh;
            margin: 0;
            padding: 10px;
            user-select: none;
            overflow: hidden;
        }
        
        .container {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 15px;
            border: 2px solid #00ff00;
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.3);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            flex-shrink: 0;
        }
        
        .title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 0 15px rgba(0, 255, 0, 0.5);
        }
        
        .subtitle {
            font-size: 12px;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
            margin-bottom: 10px;
        }
        
        .progress-grid {
            display: grid;
            grid-template-columns: 120px repeat(8, 1fr);
            gap: 8px;
            margin-bottom: 20px;
            flex: 1;
            min-height: 0;
            width: 70%;
            margin-left: auto;
            margin-right: auto;
        }
        
        .team-label {
            background: #ffff00;
            color: #000;
            padding: 9px 6px;
            text-align: center;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            max-height: 52px;
        }
        
        .progress-cell {
            background: #ffffff;
            border: 1px solid #00ff00;
            cursor: not-allowed;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #000;
            font-size: 12px;
            max-width: 52px;
            max-height: 52px;
        }
        
        .progress-cell.current {
            background: #ff8800;
            color: #000;
            cursor: pointer;
            border-color: #ff8800;
        }
        
        .progress-cell.completed {
            background: #00cc00;
            color: #000;
            cursor: pointer;
        }
        
        .progress-cell.passed {
            background: #006600;
            color: #ffffff;
            cursor: not-allowed;
            border-color: #006600;
        }
        
        .header-cell {
            background: #00ff00;
            color: #000;
            padding: 9px 6px;
            text-align: center;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            max-width: 52px;
            max-height: 52px;
        }
        

        
        .status {
            text-align: center;
            margin-top: 10px;
            font-size: 12px;
            color: #ffff00;
            flex-shrink: 0;
        }
        
                 .hidden-button {
             position: absolute;
             top: 0;
             left: 0;
             width: 50px;
             height: 50px;
             background: transparent;
             border: none;
             cursor: pointer;
             z-index: 9999;
         }

         .reset-button {
             position: fixed;
             bottom: 20px;
             right: 20px;
             padding: 10px 20px;
             font-size: 12px;
             font-weight: 700;
             background: transparent;
             border: 2px solid #ff0000;
             color: #ff0000;
             cursor: pointer;
             font-family: 'Courier Prime', monospace;
             z-index: 1000;
             transition: all 0.3s ease;
         }

         .reset-button:hover {
             background: rgba(255, 0, 0, 0.1);
         }

         .confirm-dialog {
             position: fixed;
             top: 0;
             left: 0;
             width: 100%;
             height: 100%;
             background: rgba(0, 0, 0, 0.8);
             display: none;
             justify-content: center;
             align-items: center;
             z-index: 10000;
         }

         .confirm-content {
             background: rgba(0, 0, 0, 0.9);
             border: 2px solid #00ff00;
             padding: 30px;
             text-align: center;
             font-family: 'Courier Prime', monospace;
             color: #00ff00;
             min-width: 300px;
         }

         .confirm-message {
             font-size: 16px;
             margin-bottom: 20px;
             line-height: 1.5;
         }

         .confirm-buttons {
             display: flex;
             gap: 20px;
             justify-content: center;
         }

         .confirm-btn {
             padding: 10px 20px;
             font-size: 14px;
             font-weight: 700;
             background: transparent;
             border: 2px solid #00ff00;
             color: #00ff00;
             cursor: pointer;
             font-family: 'Courier Prime', monospace;
             transition: all 0.3s ease;
         }

         .confirm-btn.yes:hover {
             background: rgba(255, 0, 0, 0.2);
             border-color: #ff0000;
             color: #ff0000;
         }

         .confirm-btn.no:hover {
             background: rgba(0, 255, 0, 0.1);
         }

         @media (max-width: 1200px) {
             .progress-grid {
                 grid-template-columns: 100px repeat(8, 1fr);
                 gap: 6px;
                 width: 70%;
             }
             .team-label {
                 font-size: 12px;
                 padding: 6px 4px;
                 max-height: 42px;
             }
             .progress-cell, .header-cell {
                 font-size: 10px;
                 padding: 6px 4px;
                 max-width: 42px;
                 max-height: 42px;
             }
             .title {
                 font-size: 18px;
             }
             .subtitle {
                 font-size: 10px;
             }
         }
         
         @media (max-width: 768px) {
             .progress-grid {
                 grid-template-columns: 70px repeat(8, 1fr);
                 gap: 4px;
                 width: 70%;
             }
             
             .team-label {
                 font-size: 9px;
                 padding: 4px 2px;
                 max-height: 30px;
             }
             .progress-cell, .header-cell {
                 font-size: 8px;
                 padding: 4px 2px;
                 max-width: 30px;
                 max-height: 30px;
             }
             .title {
                 font-size: 14px;
             }
             .subtitle {
                 font-size: 8px;
             }
         }
    </style>
</head>
<body>
    <button class="hidden-button" id="hiddenBackButton"></button>
    <div class="container">
        <div class="header">
            <div class="title">進捗管理画面</div>
            <div class="subtitle">PROGRESS MANAGEMENT SYSTEM</div>
        </div>
        
        <div class="progress-grid" id="progressGrid">
            <!-- ヘッダー行 -->
            <div class="team-label">チーム</div>
            <div class="header-cell">1</div>
            <div class="header-cell">2</div>
            <div class="header-cell">3</div>
            <div class="header-cell">4</div>
            <div class="header-cell">5</div>
            <div class="header-cell">6</div>
            <div class="header-cell">7</div>
            <div class="header-cell">8</div>
            
            <!-- チーム1 -->
            <div class="team-label">Team 1</div>
            <div class="progress-cell" data-team="1" data-task="1"></div>
            <div class="progress-cell" data-team="1" data-task="2"></div>
            <div class="progress-cell" data-team="1" data-task="3"></div>
            <div class="progress-cell" data-team="1" data-task="4"></div>
            <div class="progress-cell" data-team="1" data-task="5"></div>
            <div class="progress-cell" data-team="1" data-task="6"></div>
            <div class="progress-cell" data-team="1" data-task="7"></div>
            <div class="progress-cell" data-team="1" data-task="8"></div>
            
            <!-- チーム2 -->
            <div class="team-label">Team 2</div>
            <div class="progress-cell" data-team="2" data-task="1"></div>
            <div class="progress-cell" data-team="2" data-task="2"></div>
            <div class="progress-cell" data-team="2" data-task="3"></div>
            <div class="progress-cell" data-team="2" data-task="4"></div>
            <div class="progress-cell" data-team="2" data-task="5"></div>
            <div class="progress-cell" data-team="2" data-task="6"></div>
            <div class="progress-cell" data-team="2" data-task="7"></div>
            <div class="progress-cell" data-team="2" data-task="8"></div>
            
            <!-- チーム3 -->
            <div class="team-label">Team 3</div>
            <div class="progress-cell" data-team="3" data-task="1"></div>
            <div class="progress-cell" data-team="3" data-task="2"></div>
            <div class="progress-cell" data-team="3" data-task="3"></div>
            <div class="progress-cell" data-team="3" data-task="4"></div>
            <div class="progress-cell" data-team="3" data-task="5"></div>
            <div class="progress-cell" data-team="3" data-task="6"></div>
            <div class="progress-cell" data-team="3" data-task="7"></div>
            <div class="progress-cell" data-team="3" data-task="8"></div>
            
            <!-- チーム4 -->
            <div class="team-label">Team 4</div>
            <div class="progress-cell" data-team="4" data-task="1"></div>
            <div class="progress-cell" data-team="4" data-task="2"></div>
            <div class="progress-cell" data-team="4" data-task="3"></div>
            <div class="progress-cell" data-team="4" data-task="4"></div>
            <div class="progress-cell" data-team="4" data-task="5"></div>
            <div class="progress-cell" data-team="4" data-task="6"></div>
            <div class="progress-cell" data-team="4" data-task="7"></div>
            <div class="progress-cell" data-team="4" data-task="8"></div>
            
            <!-- チーム5 -->
            <div class="team-label">Team 5</div>
            <div class="progress-cell" data-team="5" data-task="1"></div>
            <div class="progress-cell" data-team="5" data-task="2"></div>
            <div class="progress-cell" data-team="5" data-task="3"></div>
            <div class="progress-cell" data-team="5" data-task="4"></div>
            <div class="progress-cell" data-team="5" data-task="5"></div>
            <div class="progress-cell" data-team="5" data-task="6"></div>
            <div class="progress-cell" data-team="5" data-task="7"></div>
            <div class="progress-cell" data-team="5" data-task="8"></div>
            
            <!-- チーム6 -->
            <div class="team-label">Team 6</div>
            <div class="progress-cell" data-team="6" data-task="1"></div>
            <div class="progress-cell" data-team="6" data-task="2"></div>
            <div class="progress-cell" data-team="6" data-task="3"></div>
            <div class="progress-cell" data-team="6" data-task="4"></div>
            <div class="progress-cell" data-team="6" data-task="5"></div>
            <div class="progress-cell" data-team="6" data-task="6"></div>
            <div class="progress-cell" data-team="6" data-task="7"></div>
            <div class="progress-cell" data-team="6" data-task="8"></div>
            
            <!-- チーム7 -->
            <div class="team-label">Team 7</div>
            <div class="progress-cell" data-team="7" data-task="1"></div>
            <div class="progress-cell" data-team="7" data-task="2"></div>
            <div class="progress-cell" data-team="7" data-task="3"></div>
            <div class="progress-cell" data-team="7" data-task="4"></div>
            <div class="progress-cell" data-team="7" data-task="5"></div>
            <div class="progress-cell" data-team="7" data-task="6"></div>
            <div class="progress-cell" data-team="7" data-task="7"></div>
            <div class="progress-cell" data-team="7" data-task="8"></div>
        </div>
        
        <div class="status" id="status">準備完了</div>
    </div>

    <button class="reset-button" id="resetButton">リセット</button>

    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-content">
            <div class="confirm-message">
                すべての進捗をリセットしてもよろしいですか？<br>
                この操作は元に戻せません。
            </div>
            <div class="confirm-buttons">
                <button class="confirm-btn yes" id="confirmYes">YES</button>
                <button class="confirm-btn no" id="confirmNo">NO</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getDatabase, ref, set, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCMqH0u_bO2knTMMSDjzwKbQBECUdzlwnc",
            authDomain: "lastr-36807.firebaseapp.com",
            databaseURL: "https://lastr-36807-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lastr-36807",
            storageBucket: "lastr-36807.firebasestorage.app",
            messagingSenderId: "1068261467238",
            appId: "1:1068261467238:web:22c701f8879d6bb61c79a7",
            measurementId: "G-1S8C9GC4GY"
        };

        try {
            const app = initializeApp(firebaseConfig);
            
            // Cloud Firestore
            const firestore = getFirestore(app);
            
            // Realtime Database
            const database = getDatabase(app, 'https://lastr-36807-default-rtdb.asia-southeast1.firebasedatabase.app');

            // グローバルにエクスポート
            window.firestore = firestore;
            window.database = database;
            window.firestoreDoc = doc;
            window.firestoreSetDoc = setDoc;
            window.firestoreOnSnapshot = onSnapshot;
            window.dbRef = ref;
            window.dbSet = set;
            window.dbOnValue = onValue;

            // 接続テスト
            console.log('Testing Firebase connections...');
            
            // Firestore接続テスト
            const testFirestoreRef = doc(firestore, 'gameData', 'progress');
            const unsubscribe = onSnapshot(testFirestoreRef, (snapshot) => {
                console.log('Firestore connection successful');
                document.getElementById('status').textContent = 'Firebase接続済み ✓';
                document.getElementById('status').style.color = '#00ff00';
                window.useFirestore = true;
                setTimeout(() => {
                    window.initProgress();
                }, 500);
                unsubscribe();
            }, (firestoreError) => {
                console.log('Firestore connection failed:', firestoreError);
                
                // Realtime Database接続テスト
                const testRef = ref(database, '.info/connected');
                onValue(testRef, (snapshot) => {
                    const connected = snapshot.val();
                    if (connected) {
                        console.log('Realtime Database connection successful');
                        document.getElementById('status').textContent = 'Firebase接続済み ✓';
                        document.getElementById('status').style.color = '#00ff00';
                        window.useFirestore = false;
                        setTimeout(() => {
                            window.initProgress();
                        }, 500);
                    } else {
                        console.log('Both Firebase services failed');
                        document.getElementById('status').textContent = '接続失敗 ✗';
                        document.getElementById('status').style.color = '#ff0000';
                    }
                });
            });
            
        } catch (error) {
            console.error('Firebase initialization error:', error);
            document.getElementById('status').textContent = '初期化エラー ✗';
            document.getElementById('status').style.color = '#ff0000';
        }
    </script>

    <script src="progress.js"></script>
</body>
</html> 